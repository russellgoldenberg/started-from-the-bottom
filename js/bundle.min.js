"use strict";var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};!function(){function t(t,e){return"translate("+t+","+e+")"}function e(t){return t.map(function(t,e){return _extends({},t,{seasonFormatted:$.parse(t.seasonYear),id:e})})}function n(t){return t.length%2===1?t[t.length-1]:null}function r(t){var e=t.values.map(function(t,e){return t.start||t.stop?e:-1}).filter(function(t){return t>-1}),n=e.length,r=2*Math.floor(n/2),a=e.slice(0,r),o=a.map(function(t,e){var n=e%2?t-a[e-1]:-1;return n}).filter(function(t){return t>0}).reduce(function(t,e){return t.concat(e)},[]);return{indices:e,completed:o}}function a(t){var e=0;return t.map(function(t){var n=t.bottom,r=t.top;return n&&!e?(t.start=!0,t.stretch=!0,e+=1):r&&e&&(t.stop=!0,t.stretch=!0,t.stopCount=e,e=0),e&&(t.stretch=!0,e+=1),t})}function o(t){var e=t.stretches.indices,n=e.length,r=2*Math.floor(n/2),a=e.slice(0,r),o=a.map(function(e,n){var r=e+1,o=a[n-1];return n%2?t.values.slice(o,r):null}).filter(function(t){return t});return o}function s(t){var e=t-U;return 2>e?'was <strong class="highlight top">quicker</strong> than':e>2?'took <strong class="highlight bottom">longer</strong> than':"was about"}function i(t){switch(t){case"top-and-bottom":return{all:[],wins:G.filter(function(t){return t.wins}),stretches:[]};case"warriors":var e=V.filter(function(t){return"GSW"===t.key});return{all:e,wins:e[0].values.filter(function(t){return t.wins}),stretches:[]};case"stretch-single":var n=V.filter(function(t){return t.key===R});return{all:n,wins:n[0].values.filter(function(t){return t.wins}),stretches:o(n[0])};case"stretch-all":var r=V.map(o).filter(function(t){return t.length}).reduce(function(t,e){return t.concat(e)}),a=r.reduce(function(t,e){var n=[e[0],e[e.length-1]];return t.concat(n)},[]);return{all:[],wins:a,stretches:r};case"stretch-normalized":var s=V.map(o).filter(function(t){return t.length}).reduce(function(t,e){return t.concat(e)}),i=s.reduce(function(t,e){var n=[e[0],e[e.length-1]];return t.concat(n)},[]);return{all:[],wins:i,stretches:s};case"stretch-duration":var c=V.map(o).filter(function(t){return t.length}).reduce(function(t,e){return t.concat(e)}).map(function(t){return[t[0],t[t.length-1]]}).map(function(t,e){return t[0].tempIndex=e,t}).sort(function(t,e){var n=+t[0].seasonYear-+e[0].seasonYear;return 0===n?t[0].tempIndex-e[0].tempIndex:n}),u=c.reduce(function(t,e){return t.concat(e)},[]);return{all:[],wins:u,stretches:c};case"stretch-incomplete":var l=V.filter(function(t){return null!==t.incomplete}).map(function(t){return[t.values[t.incomplete],t.values[t.values.length-1]]}).map(function(t,e){return t[0].tempIndex=e,t}).sort(function(t,e){var n=+t[0].seasonYear-+e[0].seasonYear;return 0===n?t[0].tempIndex-e[0].tempIndex:n}),d=l.map(function(t){return t[0]});return{all:[],wins:d,stretches:l};default:return{}}}function c(){return"0,"+this.getTotalLength()}function u(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+", "+t);return function(t){return e(t)}}function l(t){var e=t.length;document.querySelector(".madlib-count").innerHTML=e?"have completed the journey from the bottom to the top <strong class='highlight top'>"+I[e]+"</strong> time"+(1===e?"":"s")+" in franchise history.":"have never completed a journey to the top after starting from the bottom.";var n=e?t[e-1].length-1:0;document.querySelector(".madlib-detail").innerHTML=e?"Their most recent ascent "+s(n)+" league average, spanning "+n+" seasons.":"Maybe next year fellas..."}function d(){d3.selectAll(".annotation").transition().duration(F).ease("elastic").style("opacity",0)}function p(t){var e=d3.select(".tooltip-text"),n=d3.select(".tooltip-rect"),r=d3.select(this).attr("cx"),a=d3.select(this).attr("cy"),o=d3.select(this).attr("r"),s=A[t.name],i="â€˜"+t.season.substring(2,t.season.length),c=+t.seasonYear,u=1986>c?"left":c>2006?"end":"middle";e.text(i+" "+s+": ").attr("x",r).attr("y",a).attr("dy",3*-o).attr("text-anchor",u).append("tspan").text(t.wins+" wins");var l=e[0][0].getBBox(),d=l.x,p=l.y,f=l.width,h=l.height;n.attr("x",d-4).attr("y",p-2).attr("width",f+8).attr("height",h+4).attr("class","tooltip-rect")}function f(){d3.select(".tooltip-text").text(""),d3.select(".tooltip-rect").attr("class","tooltip-rect hide")}function h(t){P||t.on("mouseenter",p).on("mouseout",f)}function m(t){P||t.transition().delay(F).duration(F).ease("quad-in-out").style("opacity",1)}function y(e){D=e-j,j=e;var n=d3.select(".chart"),r=n.select(".all-group"),a=n.select(".wins-group"),o=n.select(".stretch-group"),s=i(T[e]),p=r.selectAll(".all").data(s.all,function(t,e){return t.key?t.key+"-"+e:e}),f=a.selectAll(".wins").data(s.wins,function(t){return t.id}),y=o.selectAll(".stretch").data(s.stretches,function(t,e){return t.length?""+t[0].id:e});switch(d(),T[e]){case"top-and-bottom":f.enter().append("circle").attr("class",function(t){return"wins "+(t.bottom?"bottom":"")+" "+(t.top?"top":"")}).attr("r",0).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t){return Q(t.rank)}).call(h),f.transition().duration(F).delay(function(t){return 50*t.rank+(0===D?0:F)}).ease("quad-in-out").attr("r",W).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t){return Q(t.rank)});break;case"warriors":p.enter().append("path").attr("class","all").style("opacity",0),p.attr("d",function(t){return nt(t.values)}).transition().delay(F).duration(F).ease("quad-in-out").style("opacity",1),f.enter().append("circle").attr("class",function(t){return"wins "+(t.bottom?"bottom":"")+" "+(t.top?"top":"")}).attr("r",0).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t){return Q(t.rank)}).call(h),f.transition().delay(function(t,e){return 1.5*F+50*e}).duration(F*C).ease("elastic").attr("r",function(t){return t.bottom||t.top?z:W}).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t){return Q(t.rank)}),d3.select(".annotation-73").call(m);break;case"stretch-single":p.enter().append("path").attr("class","all"),p.attr("d",function(t){return nt(t.values)}),y.enter().append("g").attr("class","stretch").append("path").attr("class","stretch-path").attr("stroke-width",W),y.select("path").attr("d",nt).attr("stroke-dasharray",c),y.select("path").attr("d",nt).transition().duration(F*C).ease("quad-in-out").attr("stroke-width",W).attrTween("stroke-dasharray",u),f.enter().append("circle").attr("class",function(t){return"wins "+(t.bottom?"bottom":"")+" "+(t.top?"top":"")}).attr("r",0).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t){return Q(t.rank)}).attr("cy",function(t){return Q(t.rank)}).call(h),f.transition().duration(F).ease("elastic").attr("r",function(t){return t.bottom||t.top?z:W}),!s.stretches.length||J||P||(J=!0,B.play()),l(s.stretches);break;case"stretch-all":y.enter().append("g").attr("class","stretch").attr("transform",t(0,0)).style("opacity",0).append("path").attr("class",function(t){return"stretch-path id-"+t[0].id+" id-"+t[t.length-1].id}).attr("stroke-width",2),y.transition().delay(F).duration(F).ease("quad-in-out").attr("transform",t(0,0)).style("opacity",1).select("path").transition().delay(F).duration(F).ease("quad-in-out").attr("stroke-width",2).attr("d",nt),f.enter().append("circle").attr("class",function(t){return"wins "+(t.bottom?"bottom":"")+" "+(t.top?"top":"")}).attr("r",0).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t){return Q(t.rank)}).call(h),f.transition().delay(F).duration(F).ease("quad-in-out").attr("r",W).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t){return Q(t.rank)}),d3.selectAll(".axis--y").transition().delay(F).duration(F).style("opacity",1);break;case"stretch-duration":y.enter().append("g").attr("class","stretch").attr("transform",function(e,n){return t(0,X(n))}).style("opacity",0).append("path").attr("class","stretch-path").attr("stroke-width",2),y.transition().delay(F).duration(F).ease("quad-in-out").attr("transform",function(e,n){return t(0,X(n))}).style("opacity",1).select("path").transition().delay(F).duration(F).ease("quad-in-out").attr("stroke-width",2).attr("d",rt),f.enter().append("circle").attr("class",function(t){return"wins "+(t.bottom?"bottom":"")+" "+(t.top?"top":"")}).attr("r",0).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t,e){return X(Math.floor(e/2))}).call(h),f.transition().delay(F).duration(F).ease("quad-in-out").attr("r",W).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t,e){return X(Math.floor(e/2))}),d3.selectAll(".axis--y").transition().delay(F).duration(F).style("opacity",0),d3.select(".annotation-paul").call(m),d3.select(".annotation-clippers").call(m),d3.select(".annotation-bird").call(m),d3.select(".annotation-spurs").call(m);break;case"stretch-incomplete":y.enter().append("g").attr("class","stretch").attr("transform",function(e,n){return t(0,X(n))}).style("opacity",0).append("path").attr("class","stretch-path").attr("stroke-width",2),y.transition().delay(F).duration(F).ease("quad-in-out").attr("transform",function(e,n){return t(0,X(n))}).style("opacity",1).select("path").transition().delay(F).duration(F).ease("quad-in-out").attr("stroke-width",2).attr("d",rt),f.enter().append("circle").attr("class",function(t){return"wins "+(t.bottom?"bottom":"")+" "+(t.top?"top":"")}).attr("r",0).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t,e){return X(e)}).call(h),f.transition().delay(F).duration(F).ease("quad-in-out").attr("r",W).attr("cx",function(t){return Z(t.seasonFormatted)}).attr("cy",function(t,e){return X(e)}),d3.selectAll(".axis--y").transition().delay(F).duration(F).style("opacity",0),d3.select(".annotation-brooklyn").call(m),d3.select(".annotation-kobe").call(m);break;default:return{}}p.exit().transition().duration(0===D?0:F).style("opacity",0).remove(),f.exit().transition().duration(0===D?0:F).attr("r",0).remove(),y.exit().transition().duration(0===D?0:F).style("opacity",0).remove()}function g(){graphScroll().container(d3.select("#container")).graph(d3.select("#graphic")).sections(d3.selectAll("section")).on("active",y)}function v(){var t=d3.select("svg"),e=t.append("g").attr("class","chart");e.append("g").attr("class","axis axis--x"),e.append("g").attr("class","axis axis--y"),e.append("g").attr("class","axis axis--y axis--y-label").append("text").text("Rank (regular season)").attr("dy","-2em").style("text-anchor","middle"),e.append("g").attr("class","all-group"),e.append("g").attr("class","stretch-group"),e.append("g").attr("class","wins-group"),e.append("rect").attr("class","tooltip-rect").attr("rx",2).attr("ry",2),e.append("text").attr("class","tooltip-text")}function x(e){var n=P?0:E,r=P?0:O,a=P?0:Y,o={top:P?10:N.top,left:N.left,bottom:N.bottom,right:P?10:N.right},s=e-n-r,i=P?e:Math.round(window.innerHeight-2*r-a),c=s-o.left-o.right,u=i-o.top-o.bottom;W=Math.max(2,Math.round(i/200)),z=Math.round(W*H),d3.select("svg").attr("width",s).attr("height",i),d3.select(".chart").attr("transform",t(o.left,o.top)),Z.range([0,c]),Q.range([0,u]),X.range([0,u]),d3.select(".axis--x").attr("transform",t(0,u)).call(tt),d3.select(".axis--y").attr("transform",t(0,0)).call(et),d3.select(".axis--y-label").attr("transform",t(0,Math.floor(u/2))+" rotate(-90)"),g()}function w(t,o){G=e(o);var s=d3.nest().key(function(t){return t.name}).entries(G);V=s.map(function(t){return _extends({},t,{values:a(t.values)})}).map(function(t){return _extends({},t,{stretches:r(t)})}).map(function(t){return _extends({},t,{incomplete:n(t.stretches.indices)})});var i=V.reduce(function(t,e){return t.concat(e.stretches.completed)},[]);_=i.length,U=d3.median(i),K=V.reduce(function(t,e){return null!==e.incomplete?t+=1:t},0),Z.domain(d3.extent(G,function(t){return t.seasonFormatted})),Q.domain([1,G.filter(function(t){return"2015-16"===t.season}).length+1]),X.domain([0,_]),tt=d3.svg.axis().scale(Z).orient("bottom").tickFormat(d3.time.format("%Y")),et=d3.svg.axis().scale(Q).orient("left").tickValues([1,5,10,15,20,25,30]),k(),b(),S()}function k(){var t=document.querySelector(".madlib-name"),e=Object.keys(A).map(function(t){var e="GSW"===t?" selected":"";return"<option"+e+" value='"+t+"'>"+A[t]+"</option>"}).join("\n");t.innerHTML=e,t.addEventListener("change",function(){R=this.value,2===j&&y(2)});var n=V.filter(function(t){return"GSW"===t.key});l(o(n[0])),document.querySelector(".madlib-total").textContent=_,document.querySelector(".madlib-median").textContent=U}function b(){var t=document.getElementById("container").offsetWidth;P=850>t,G.length&&x(t)}function S(){d3.select(".chart").append("marker").attr("id","arrow").attr("viewBox","-10 -10 20 20").attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("path").attr("d","M-6.75,-6.75 L 0,0 L -6.75,6.75");var t=d3.swoopyDrag().x(function(t){return Z($.parse(t.x))}).y(function(t){return Q(t.y)}).draggable(M).annotations(annotationsRank).className(function(t){return t.className}),e=d3.select(".chart").append("g").attr("class","annotations annotations-rank").call(t);e.selectAll("path").attr("marker-end","url(#arrow)");var n=d3.swoopyDrag().x(function(t){return Z($.parse(t.x))}).y(function(t){return X(t.y)}).draggable(M).annotations(annotationsOrder).className(function(t){return t.className}),r=d3.select(".chart").append("g").attr("class","annotations annotations-order").call(n);r.selectAll("path").attr("marker-end","url(#arrow)")}function q(){var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e);var n=null,r=!1,a=function(){var t=document.querySelector(".stephen-curry"),e=document.querySelector(".youtube");t.addEventListener("mouseenter",function(t){e.classList.remove("transparent"),n.playVideo()}),t.addEventListener("mouseout",function(t){e.classList.add("transparent"),n.pauseVideo()})},o=function(t){n.mute(),n.playVideo()},s=function(t){r||1!==t.data||(r=!0,n.pauseVideo(),n.unMute(),n.setVolume(50),a())};window.onYouTubeIframeAPIReady=function(){n=new YT.Player("player",{height:"100%",width:"100%",videoId:"tvN-EYgYSZI",events:{onReady:o,onStateChange:s}})}}function L(){v(),window.addEventListener("resize",b),d3.json("data/output.json",w),P||q()}var M=!1,A={ATL:"Hawks",BOS:"Celtics",BRK:"Nets",CHI:"Bulls",CHO:"Hornets",CLE:"Cavaliers",DAL:"Mavericks",DEN:"Nuggets",DET:"Pistons",GSW:"Warriors",HOU:"Rockets",IND:"Pacers",LAC:"Clippers",LAL:"Lakers",MEM:"Grizzlies",MIA:"Heat",MIL:"Bucks",MIN:"Timberwolves",NOP:"Pelicans",NYK:"Knicks",OKC:"Thunder",ORL:"Magic",PHI:"76ers",PHO:"Suns",POR:"Trail Blazers",SAC:"Kings",SAS:"Spurs",TOR:"Raptors",UTA:"Jazz",WAS:"Wizards"},I=["zero","one","two","three","four","five"],T=["top-and-bottom","warriors","stretch-single","stretch-all","stretch-duration","stretch-incomplete"],F=1e3,N={top:40,right:40,bottom:40,left:40},O=20,C=2.8,H=1.5,Y=18,E=360,B=document.querySelector(".sample"),P=!1,R="GSW",W=0,z=0,j=0,D=0,G=[],V=[],_=0,K=0,U=0,J=!1,Z=d3.time.scale(),Q=d3.scale.linear(),X=d3.scale.linear(),$=d3.time.format("%Y"),tt=null,et=null,nt=d3.svg.line().defined(function(t){return t.rank}).interpolate("step").x(function(t){return Z(t.seasonFormatted)}).y(function(t){return Q(t.rank)}),rt=d3.svg.line().defined(function(t){return t.rank}).interpolate("linear").x(function(t){return Z(t.seasonFormatted)}).y(function(t){return 0});L()}();